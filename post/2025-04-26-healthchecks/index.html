

<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

 


      <title>Health Checks - Paolo Fullone</title>

  <meta name="description" content="A Practical Guide">
  <meta name="author" content="home"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Paolo Fullone",
    
    "url": "https:\/\/paolofullone.github.io\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/paolofullone.github.io\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/paolofullone.github.io\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/paolofullone.github.io\/post\/2025-04-26-healthchecks\/",
          "name": "Health checks"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Paolo Fullone"
  },
  "headline": "Health Checks",
  "description" : "In a microservices architecture, ensuring each service communicates reliably with databases like SQL Server and Oracle is critical but challenging due to restricted permissions. Health checks monitor service health, and in this post, I focus on advanced checks that execute custom queries to verify table access, beyond standard NuGet packages. I\u0026rsquo;ve learned to anticipate issues like permission errors, ensuring robust systems for global teams.\nI developed a MultiDatabase health check to test specific queries across SQL Server and Oracle, addressing the challenge of limited database access rights that require DBA intervention (e.g., user creation, encrypted connection strings). This check integrates with CI\/CD pipelines, catching issues before deployment, complementing my 95% test coverage in projects like RunningTracker.\n",
  "inLanguage" : "en",
  "wordCount":  625 ,
  "datePublished" : "2025-04-26T00:00:00\u002b00:00",
  "dateModified" : "2025-04-26T00:00:00\u002b00:00",
  "image" : "https:\/\/paolofullone.github.io\/img\/avatar-icon.png",
  "keywords" : [ "HealthChecks, .NET, C#, Kubernetes, Microservices, Oracle, SQL Server, Docker" ],
  "mainEntityOfPage" : "https:\/\/paolofullone.github.io\/post\/2025-04-26-healthchecks\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/paolofullone.github.io\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/paolofullone.github.io\/img\/avatar-icon.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>


<meta property="og:title" content="Health Checks" />
<meta property="og:description" content="A Practical Guide">
<meta property="og:image" content="https://paolofullone.github.io/img/avatar-icon.png" />
<meta property="og:url" content="https://paolofullone.github.io/post/2025-04-26-healthchecks/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Paolo Fullone" />

  <meta name="twitter:title" content="Health Checks" />
  <meta name="twitter:description" content="A Practical Guide">
  <meta name="twitter:image" content="https://paolofullone.github.io/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <link href='https://paolofullone.github.io/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.145.0">
  <link rel="alternate" href="https://paolofullone.github.io/index.xml" type="application/rss+xml" title="Paolo Fullone"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css" integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.6.0/css/all.css" integrity="sha384-h/hnnw1Bi4nbpD6kE7nYfCXzovi622sY5WBxww8ARKwpdLj5kUWjRuyiXaD1U2JT" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous"><link rel="stylesheet" href="https://paolofullone.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://paolofullone.github.io/css/highlight.min.css" /><link rel="stylesheet" href="https://paolofullone.github.io/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://paolofullone.github.io/">Paolo Fullone</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="About" href="/page/about/">About</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/tags">Tags</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="Paolo Fullone" href="https://paolofullone.github.io/">
            <img class="avatar-img" src="https://paolofullone.github.io/img/avatar-icon.png" alt="Paolo Fullone" />
           
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>Health Checks</h1>
              
              
              
                
                  <h2 class="post-subheading">A Practical Guide</h2>
                
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on April 26, 2025
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;3&nbsp;minutes
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;625&nbsp;words
  
  
    
      
        &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Paolo Fullone
      
    
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>In a microservices architecture, ensuring each service communicates reliably with databases like SQL Server and Oracle is critical but challenging due to restricted permissions. Health checks monitor service health, and in this post, I focus on advanced checks that execute <em>custom queries</em> to verify table access, beyond standard NuGet packages. I&rsquo;ve learned to anticipate issues like permission errors, ensuring robust systems for global teams.</p>
<p>I developed a <code>MultiDatabase</code> health check to test specific queries across SQL Server and Oracle, addressing the challenge of limited database access rights that require DBA intervention (e.g., user creation, encrypted connection strings). This check integrates with CI/CD pipelines, catching issues before deployment, complementing my 95% test coverage in projects like RunningTracker.</p>
<p><img src="/img/HealthChecks/hc_ok_general.png" alt="General Health Check">
<em>The MultiDatabase health check confirms connectivity and query execution for SQL Server and Oracle.</em></p>
<h2 id="implementation">Implementation</h2>
<p>The <code>MultiDatabaseHealthCheck</code> class executes custom queries, reporting health status for each database. It supports multiple providers, handles errors gracefully, and integrates with ASP.NET Core HealthChecks. Here’s the setup:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="n">services</span><span class="p">.</span><span class="n">AddHealthChecks</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">AddCheck</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">&#34;live&#34;</span><span class="p">,</span> <span class="n">check</span><span class="p">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="n">HealthCheckResult</span><span class="p">.</span><span class="n">Healthy</span><span class="p">(),</span> <span class="n">tags</span><span class="p">:</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span> <span class="s">&#34;live&#34;</span><span class="p">,</span> <span class="s">&#34;ready&#34;</span> <span class="p">},</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromSeconds</span><span class="p">(</span><span class="m">30</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">AddKafka</span><span class="p">(</span><span class="n">kafkaConfig</span><span class="p">!,</span> <span class="n">kafkaTopic</span><span class="p">!,</span> <span class="n">name</span><span class="p">:</span> <span class="s">&#34;Kafka&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">AddSqlServer</span><span class="p">(</span><span class="n">sqlServer</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="s">&#34;SqlServer&#34;</span><span class="p">,</span> <span class="n">failureStatus</span><span class="p">:</span> <span class="n">HealthStatus</span><span class="p">.</span><span class="n">Unhealthy</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span> <span class="s">&#34;db&#34;</span><span class="p">,</span> <span class="s">&#34;mssql&#34;</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">AddOracle</span><span class="p">(</span><span class="n">oracle</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="s">&#34;Oracle&#34;</span><span class="p">,</span> <span class="n">failureStatus</span><span class="p">:</span> <span class="n">HealthStatus</span><span class="p">.</span><span class="n">Unhealthy</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span> <span class="s">&#34;db&#34;</span><span class="p">,</span> <span class="s">&#34;oracle&#34;</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">AddCheck</span><span class="p">&lt;</span><span class="n">HealthCheckExtensionMultiDatabase</span><span class="p">&gt;(</span><span class="n">name</span><span class="p">:</span> <span class="s">&#34;MultiDatabase&#34;</span><span class="p">,</span> <span class="n">failureStatus</span><span class="p">:</span> <span class="n">HealthStatus</span><span class="p">.</span><span class="n">Unhealthy</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span> <span class="s">&#34;db&#34;</span><span class="p">,</span> <span class="s">&#34;mssql&#34;</span><span class="p">,</span> <span class="s">&#34;oracle&#34;</span> <span class="p">});</span>
</span></span></code></pre></div><p>The <code>MultiDatabaseHealthCheck</code> implementation (simplified for brevity; full code linked below):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">HealthCheckExtensionMultiDatabase</span><span class="p">(</span><span class="n">IDictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="p">(</span><span class="kt">string</span> <span class="n">connectionString</span><span class="p">,</span> <span class="n">IList</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">Queries</span><span class="p">,</span> <span class="kt">string</span> <span class="n">provider</span><span class="p">)&gt;</span> <span class="n">databasesQueries</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">_databasesQueries</span> <span class="p">=</span> <span class="n">databasesQueries</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="n">HealthCheckResult</span><span class="p">&gt;</span> <span class="n">CheckHealthAsync</span><span class="p">(</span><span class="n">HealthCheckContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">CancellationToken</span> <span class="n">cancellationToken</span> <span class="p">=</span> <span class="k">default</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">healthCheckResults</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">HealthCheckResult</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">dbQuery</span> <span class="k">in</span> <span class="n">_databasesQueries</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">query</span> <span class="k">in</span> <span class="n">dbQuery</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">Queries</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">connection</span> <span class="p">=</span> <span class="n">CreateConnection</span><span class="p">(</span><span class="n">dbQuery</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">connectionString</span><span class="p">,</span> <span class="n">dbQuery</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">Provider</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">await</span> <span class="n">connection</span><span class="p">.</span><span class="n">OpenAsync</span><span class="p">(</span><span class="n">cancellationToken</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">command</span> <span class="p">=</span> <span class="n">CreateCommand</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">dbQuery</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">Provider</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="k">await</span> <span class="n">command</span><span class="p">.</span><span class="n">ExecuteScalarAsync</span><span class="p">(</span><span class="n">cancellationToken</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                        <span class="n">healthCheckResults</span><span class="p">[</span><span class="s">$&#34;{dbQuery.Key}-{query}&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="n">HealthCheckResult</span><span class="p">.</span><span class="n">Healthy</span><span class="p">(</span><span class="s">&#34;ok&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="kt">var</span> <span class="n">errorMessage</span> <span class="p">=</span> <span class="n">Regex</span><span class="p">.</span><span class="n">Unescape</span><span class="p">(</span><span class="s">$&#34;Exception during query execution: {ex.Message}&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">healthCheckResults</span><span class="p">[</span><span class="s">$&#34;{dbQuery.Key}-{query}&#34;</span><span class="p">]</span> <span class="p">=</span> <span class="n">HealthCheckResult</span><span class="p">.</span><span class="n">Unhealthy</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">overallStatus</span> <span class="p">=</span> <span class="n">healthCheckResults</span><span class="p">.</span><span class="n">Values</span><span class="p">.</span><span class="n">All</span><span class="p">(</span><span class="n">result</span> <span class="p">=&gt;</span> <span class="n">result</span><span class="p">.</span><span class="n">Status</span> <span class="p">==</span> <span class="n">HealthStatus</span><span class="p">.</span><span class="n">Healthy</span><span class="p">)</span> <span class="p">?</span> <span class="n">HealthStatus</span><span class="p">.</span><span class="n">Healthy</span> <span class="p">:</span> <span class="n">HealthStatus</span><span class="p">.</span><span class="n">Unhealthy</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">HealthCheckResult</span><span class="p">(</span><span class="n">overallStatus</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="s">&#34;Multi-database health check&#34;</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">healthCheckResults</span><span class="p">.</span><span class="n">ToDictionary</span><span class="p">(</span><span class="n">kvp</span> <span class="p">=&gt;</span> <span class="n">kvp</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span> <span class="n">kvp</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="kt">object</span><span class="p">)</span><span class="n">kvp</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">Description</span><span class="p">!)!);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">DbConnection</span> <span class="n">CreateConnection</span><span class="p">(</span><span class="kt">string</span> <span class="n">connectionString</span><span class="p">,</span> <span class="kt">string</span> <span class="n">provider</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">provider</span> <span class="k">switch</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;SqlServer&#34;</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">SqlConnection</span><span class="p">(</span><span class="n">connectionString</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;Oracle&#34;</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">OracleConnection</span><span class="p">(</span><span class="n">connectionString</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">_</span> <span class="p">=&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">NotSupportedException</span><span class="p">(</span><span class="s">$&#34;Provider {provider} is not supported.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">DbCommand</span> <span class="n">CreateCommand</span><span class="p">(</span><span class="kt">string</span> <span class="n">query</span><span class="p">,</span> <span class="n">DbConnection</span> <span class="n">connection</span><span class="p">,</span> <span class="kt">string</span> <span class="n">provider</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">provider</span> <span class="k">switch</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;SqlServer&#34;</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">SqlCommand</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">SqlConnection</span><span class="p">)</span><span class="n">connection</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;Oracle&#34;</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">OracleCommand</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">OracleConnection</span><span class="p">)</span><span class="n">connection</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">_</span> <span class="p">=&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">NotSupportedException</span><span class="p">(</span><span class="s">$&#34;Provider {provider} is not supported.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="testing-permissions">Testing Permissions</h2>
<p>The Oracle database is initialized via Docker Compose, executing an SQL script to create users (<code>ADMIN</code>, <code>TESTUSER</code>) and tables (<code>SAMPLE_MESSAGES</code>, <code>WO_ACCESS</code>). Run docker-compose up to set up the environment. The script configures permissions to simulate real-world scenarios:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">ALTER</span><span class="w"> </span><span class="k">SESSION</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">CONTAINER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XEPDB1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="k">ADMIN</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">password</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GRANT</span><span class="w"> </span><span class="k">CONNECT</span><span class="p">,</span><span class="w"> </span><span class="n">RESOURCE</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">ADMIN</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">ADMIN</span><span class="p">.</span><span class="n">SAMPLE_MESSAGES</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">NUMBER</span><span class="w"> </span><span class="k">GENERATED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">IDENTITY</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">message_id</span><span class="w"> </span><span class="n">RAW</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">SYS_GUID</span><span class="p">()</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">message_date</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">message_deleted_date</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">ADMIN</span><span class="p">.</span><span class="n">WO_ACCESS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">NUMBER</span><span class="w"> </span><span class="k">GENERATED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">IDENTITY</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">message_id</span><span class="w"> </span><span class="n">RAW</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">SYS_GUID</span><span class="p">()</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">message_date</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">message_deleted_date</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="n">TESTUSER</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">password</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GRANT</span><span class="w"> </span><span class="k">CONNECT</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">TESTUSER</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GRANT</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">ADMIN</span><span class="p">.</span><span class="n">SAMPLE_MESSAGES</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">TESTUSER</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">COMMIT</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>Using <code>TESTUSER</code>, the application lacks access to <code>ADMIN.WO_ACCESS</code>, triggering an Oracle “Table or view doesn’t exist” error:</p>
<p><img src="/img/HealthChecks/HC_TestUser.png" alt="Permission Error"></p>
<p>An Oracle permission error is detected when TESTUSER lacks access to the WO_ACCESS table.</p>
<p>If I configure the user in <code>appsettings.json</code> with proper access (e.g., <code>ADMIN</code>), the HealthCheck returns Healthy. This ensures deployment readiness.</p>
<h2 id="conclusion">Conclusion</h2>
<p>The <code>MultiDatabase</code> health check addresses real-world database access challenges, integrating seamlessly with CI/CD pipelines. For simple queries, ExecuteScalarAsync verifies access; for complex queries, adapt to <code>ExecuteReaderAsync</code>. Explore the complete code in my <a href="https://github.com/paolofullone/Kafka">GitHub repository</a>.</p>
<p>Connect via <a href="https://www.linkedin.com/in/paolofullone">LinkedIn</a> to discuss microservices reliability!</p>


        
          <div class="blog-tags">
            
              
              <a href="https://paolofullone.github.io/tags/healthchecks/">HealthChecks</a>&nbsp;
            
              
              <a href="https://paolofullone.github.io/tags/.net/">.NET</a>&nbsp;
            
              
              <a href="https://paolofullone.github.io/tags/c/">C#</a>&nbsp;
            
              
              <a href="https://paolofullone.github.io/tags/kubernetes/">Kubernetes</a>&nbsp;
            
              
              <a href="https://paolofullone.github.io/tags/microservices/">Microservices</a>&nbsp;
            
              
              <a href="https://paolofullone.github.io/tags/oracle/">Oracle</a>&nbsp;
            
              
              <a href="https://paolofullone.github.io/tags/sql-server/">SQL Server</a>&nbsp;
            
              
              <a href="https://paolofullone.github.io/tags/docker/">Docker</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2fpaolofullone.github.io%2fpost%2f2025-04-26-healthchecks%2f&amp;text=Health%20Checks&amp;via=" target="_blank" title="Share on Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fpaolofullone.github.io%2fpost%2f2025-04-26-healthchecks%2f" target="_blank" title="Share on Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//reddit.com/submit?url=https%3a%2f%2fpaolofullone.github.io%2fpost%2f2025-04-26-healthchecks%2f&amp;title=Health%20Checks" target="_blank" title="Share on Reddit">
          <i class="fab fa-reddit"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fpaolofullone.github.io%2fpost%2f2025-04-26-healthchecks%2f&amp;title=Health%20Checks" target="_blank" title="Share on LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fpaolofullone.github.io%2fpost%2f2025-04-26-healthchecks%2f&amp;title=Health%20Checks" target="_blank" title="Share on StumbleUpon">
          <i class="fab fa-stumbleupon"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fpaolofullone.github.io%2fpost%2f2025-04-26-healthchecks%2f&amp;description=Health%20Checks" target="_blank" title="Share on Pinterest">
          <i class="fab fa-pinterest"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
          
            
          

          
                  <h4 class="see-also">See also</h4>
                  <ul>
                
                
                    <li><a href="/post/2025-04-10-runningtracker/">RunningTracker API</a></li>
                
                    <li><a href="/post/2025-04-08-signalr/">SignalR for Real-Time Stock Data</a></li>
                
                    <li><a href="/post/2025-03-16-kafka/">Kafka for Microservices</a></li>
                
              </ul>

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://paolofullone.github.io/post/2025-04-10-runningtracker/" data-toggle="tooltip" data-placement="top" title="RunningTracker API">&larr; Previous Post</a>
            </li>
          
          
        </ul>
      


      
      
      
      
      
        
      

    </div>
  </div>
</div>

      <footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
		
		  <a href="mailto:paolo.enrico@gmail.com%25!%28EXTRA%20string=paolo.enrico@gmail.com%29" title="Email me">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://github.com/paolofullone%25!%28EXTRA%20string=paolofullone%29" title="GitHub">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://linkedin.com/in/paolofullone%25!%28EXTRA%20string=paolofullone%29" title="LinkedIn">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://medium.com/@paolo.enrico%25!%28EXTRA%20string=@paolo.enrico%29" title="Medium">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-medium fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="https://paolofullone.github.io/">home</a>
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2025
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://paolofullone.github.io/">Paolo Fullone</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.145.0</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="https://paolofullone.github.io/js/main.js"></script>
<script src="https://paolofullone.github.io/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://paolofullone.github.io/js/load-photoswipe.js"></script>










    
  </body>
</html>

